from django.contrib.auth.decorators import login_required

@login_required
def booking_form(request, room_id):
    message = ''
    if request.method == 'POST':
        if request.user.role != 'traveler':
            message = "Only travelers can book."
        else:
            data = {
                "room": room_id,
                "traveler": request.user.id,  
                "check_in": request.POST.get('check_in'),
                "check_out": request.POST.get('check_out')
            }
            res = requests.post(f"{API_BASE}bookings/", json=data,
                                cookies=request.COOKIES)  # pass session cookies
            message = "Booking successful!" if res.status_code in [200, 201] else "Booking failed."

    room_res = requests.get(f"{API_BASE}rooms/{room_id}/")
    room = room_res.json() if room_res.status_code == 200 else {}

    return render(request, 'frontend_bookings/booking_form.html', {'room': room, 'message': message})
